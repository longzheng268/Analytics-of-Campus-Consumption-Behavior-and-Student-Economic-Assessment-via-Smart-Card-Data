name: ä¾èµ–æ›´æ–°æ£€æŸ¥

on:
  schedule:
    # Run every Monday at 9:00 AM UTC (5:00 PM Beijing Time)
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  check-dependencies:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install pip-tools
      run: |
        python -m pip install --upgrade pip
        pip install pip-tools
    
    - name: Check for outdated packages
      run: |
        pip install -r requirements.txt
        echo "## ðŸ“¦ å½“å‰ä¾èµ–åŒ…çŠ¶æ€" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### å·²å®‰è£…çš„åŒ…ç‰ˆæœ¬:" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        pip list --format=freeze | grep -E "(pandas|numpy|matplotlib|seaborn|scikit-learn|streamlit|plotly)" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### è¿‡æ—¶çš„åŒ…æ£€æŸ¥:" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        pip list --outdated --format=freeze | grep -E "(pandas|numpy|matplotlib|seaborn|scikit-learn|streamlit|plotly)" >> $GITHUB_STEP_SUMMARY || echo "æ‰€æœ‰å…³é”®ä¾èµ–åŒ…éƒ½æ˜¯æœ€æ–°çš„!" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
    
    - name: Security vulnerability check
      run: |
        pip install safety
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ”’ å®‰å…¨æ¼æ´žæ£€æŸ¥:" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        safety check --json || echo "å‘çŽ°å®‰å…¨æ¼æ´žï¼Œè¯·æ£€æŸ¥ä¸Šè¿°è¾“å‡º" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY